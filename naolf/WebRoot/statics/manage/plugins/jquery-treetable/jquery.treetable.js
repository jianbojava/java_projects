(function(D){var A,B,C;A=(function(){function E(H,F,I){var G;this.row=H;this.tree=F;this.settings=I;this.id=this.row.data(this.settings.nodeIdAttr);G=this.row.data(this.settings.parentIdAttr);if(G!=null&&G!==""){this.parentId=G}this.treeCell=D(this.row.children(this.settings.columnElType)[this.settings.column]);this.expander=D(this.settings.expanderTemplate);this.indenter=D(this.settings.indenterTemplate);this.children=[];this.initialized=false;this.treeCell.prepend(this.indenter)}E.prototype.addChild=function(F){return this.children.push(F)};E.prototype.ancestors=function(){var G,F;F=this;G=[];while(F=F.parentNode()){G.push(F)}return G};E.prototype.collapse=function(){if(this.collapsed()){return this}this.row.removeClass("expanded").addClass("collapsed");this._hideChildren();this.expander.attr("title",this.settings.stringExpand);if(this.initialized&&this.settings.onNodeCollapse!=null){this.settings.onNodeCollapse.apply(this)}return this};E.prototype.collapsed=function(){return this.row.hasClass("collapsed")};E.prototype.expand=function(){if(this.expanded()){return this}this.row.removeClass("collapsed").addClass("expanded");if(this.initialized&&this.settings.onNodeExpand!=null){this.settings.onNodeExpand.apply(this)}if(D(this.row).is(":visible")){this._showChildren()}this.expander.attr("title",this.settings.stringCollapse);return this};E.prototype.expanded=function(){return this.row.hasClass("expanded")};E.prototype.hide=function(){this._hideChildren();this.row.hide();return this};E.prototype.isBranchNode=function(){if(this.children.length>0||this.row.data(this.settings.branchAttr)===true){return true}else{return false}};E.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch");this.row.removeClass("leaf");this.row.addClass(this.isBranchNode()?"branch":"leaf")};E.prototype.level=function(){return this.ancestors().length};E.prototype.parentNode=function(){if(this.parentId!=null){return this.tree[this.parentId]}else{return null}};E.prototype.removeChild=function(G){var F=D.inArray(G,this.children);return this.children.splice(F,1)};E.prototype.render=function(){var F,G=this.settings,H;if(G.expandable===true&&this.isBranchNode()){F=function(I){D(this).parents("table").treetable("node",D(this).parents("tr").data(G.nodeIdAttr)).toggle();return I.preventDefault()};this.indenter.html(this.expander);H=G.clickableNodeNames===true?this.treeCell:this.expander;H.off("click.treetable").on("click.treetable",F);H.off("keydown.treetable").on("keydown.treetable",function(I){if(I.keyCode==13){F.apply(this,[I])}})}this.indenter[0].style.paddingLeft=""+(this.level()*G.indent)+"px";return this};E.prototype.reveal=function(){if(this.parentId!=null){this.parentNode().reveal()}return this.expand()};E.prototype.setParent=function(F){if(this.parentId!=null){this.tree[this.parentId].removeChild(this)}this.parentId=F.id;this.row.data(this.settings.parentIdAttr,F.id);return F.addChild(this)};E.prototype.show=function(){if(!this.initialized){this._initialize()}this.row.show();if(this.expanded()){this._showChildren()}return this};E.prototype.toggle=function(){if(this.expanded()){this.collapse()}else{this.expand()}return this};E.prototype._hideChildren=function(){var H,G,J,I,F;I=this.children;F=[];for(G=0,J=I.length;G<J;G++){H=I[G];F.push(H.hide())}return F};E.prototype._initialize=function(){var F=this.settings;this.render();if(F.expandable===true&&F.initialState==="collapsed"){this.collapse()}else{this.expand()}if(F.onNodeInitialized!=null){F.onNodeInitialized.apply(this)}return this.initialized=true};E.prototype._showChildren=function(){var H,G,J,I,F;I=this.children;F=[];for(G=0,J=I.length;G<J;G++){H=I[G];F.push(H.show())}return F};return E})();B=(function(){function E(G,F){this.table=G;this.settings=F;this.tree={};this.nodes=[];this.roots=[]}E.prototype.collapseAll=function(){var H,G,J,I,F;I=this.nodes;F=[];for(G=0,J=I.length;G<J;G++){H=I[G];F.push(H.collapse())}return F};E.prototype.expandAll=function(){var H,G,J,I,F;I=this.nodes;F=[];for(G=0,J=I.length;G<J;G++){H=I[G];F.push(H.expand())}return F};E.prototype.findLastNode=function(F){if(F.children.length>0){return this.findLastNode(F.children[F.children.length-1])}else{return F}};E.prototype.loadRows=function(I){var H,G,F;if(I!=null){for(F=0;F<I.length;F++){G=D(I[F]);if(G.data(this.settings.nodeIdAttr)!=null){H=new A(G,this.tree,this.settings);this.nodes.push(H);this.tree[H.id]=H;if(H.parentId!=null&&this.tree[H.parentId]){this.tree[H.parentId].addChild(H)}else{this.roots.push(H)}}}}for(F=0;F<this.nodes.length;F++){H=this.nodes[F].updateBranchLeafClass()}return this};E.prototype.move=function(G,F){var H=G.parentNode();if(G!==F&&F.id!==G.parentId&&D.inArray(G,F.ancestors())===-1){G.setParent(F);this._moveRows(G,F);if(G.parentNode().children.length===1){G.parentNode().render()}}if(H){H.updateBranchLeafClass()}if(G.parentNode()){G.parentNode().updateBranchLeafClass()}G.updateBranchLeafClass();return this};E.prototype.removeNode=function(F){this.unloadBranch(F);F.row.remove();if(F.parentId!=null){F.parentNode().removeChild(F)}delete this.tree[F.id];this.nodes.splice(D.inArray(F,this.nodes),1);return this};E.prototype.render=function(){var F,H,I,G;G=this.roots;for(H=0,I=G.length;H<I;H++){F=G[H];F.show()}return this};E.prototype.sortBranch=function(F,G){F.children.sort(G);this._sortChildRows(F);return this};E.prototype.unloadBranch=function(G){var H=G.children.slice(0),F;for(F=0;F<H.length;F++){this.removeNode(H[F])}G.children=[];G.updateBranchLeafClass();return this};E.prototype._moveRows=function(H,F){var I=H.children,G;H.row.insertAfter(F.row);H.render();for(G=I.length-1;G>=0;G--){this._moveRows(I[G],H)}};E.prototype._sortChildRows=function(F){return this._moveRows(F,F)};return E})();C={init:function(F,G){var E;E=D.extend({branchAttr:"ttBranch",clickableNodeNames:false,column:0,columnElType:"td",expandable:false,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},F);return this.each(function(){var H=D(this),I;if(G||H.data("treetable")===undefined){I=new B(this,E);I.loadRows(this.rows).render();H.addClass("treetable").data("treetable",I);if(E.onInitialized!=null){E.onInitialized.apply(I)}}return H})},destroy:function(){return this.each(function(){return D(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){this.data("treetable").collapseAll();return this},collapseNode:function(F){var E=this.data("treetable").tree[F];if(E){E.collapse()}else{throw new Error("Unknown node '"+F+"'")}return this},expandAll:function(){this.data("treetable").expandAll();return this},expandNode:function(F){var E=this.data("treetable").tree[F];if(E){if(!E.initialized){E._initialize()}E.expand()}else{throw new Error("Unknown node '"+F+"'")}return this},loadBranch:function(F,G){var H=this.data("treetable").settings,E=this.data("treetable").tree;G=D(G);if(F==null){this.append(G)}else{var I=this.data("treetable").findLastNode(F);G.insertAfter(I.row)}this.data("treetable").loadRows(G);G.filter("tr").each(function(){E[D(this).data(H.nodeIdAttr)].show()});if(F!=null){F.render().expand()}return this},move:function(E,H){var G,F;F=this.data("treetable").tree[E];G=this.data("treetable").tree[H];this.data("treetable").move(F,G);return this},node:function(E){return this.data("treetable").tree[E]},removeNode:function(F){var E=this.data("treetable").tree[F];if(E){this.data("treetable").removeNode(E)}else{throw new Error("Unknown node '"+F+"'")}return this},reveal:function(F){var E=this.data("treetable").tree[F];if(E){E.reveal()}else{throw new Error("Unknown node '"+F+"'")}return this},sortBranch:function(G,E){var H=this.data("treetable").settings,F,I;E=E||H.column;I=E;if(D.isNumeric(E)){I=function(M,L){var N,K,J;N=function(O){var P=O.row.find("td:eq("+E+")").text();return D.trim(P).toUpperCase()};K=N(M);J=N(L);if(K<J){return -1}if(K>J){return 1}return 0}}this.data("treetable").sortBranch(G,I);return this},unloadBranch:function(E){this.data("treetable").unloadBranch(E);return this}};D.fn.treetable=function(E){if(C[E]){return C[E].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof E==="object"||!E){return C.init.apply(this,arguments)}else{return D.error("Method "+E+" does not exist on jQuery.treetable")}}};window.TreeTable||(window.TreeTable={});window.TreeTable.Node=A;window.TreeTable.Tree=B})(jQuery);